<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Color Wheel</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
    }

    canvas {
      border-radius: 50%;
    }

    #controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
    }

    #edit-box {
      display: none;
      flex-direction: column;
      align-items: stretch;
      gap: 10px;
      width: 200px;
    }

    #edit-box textarea {
      width: 100%;
      height: 200px;
    }

    #save-cancel {
      display: flex;
      justify-content: space-between;
    }

    #pointer {
      width: 0;
      height: 0;
      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      border-right: 30px solid red;
      position: absolute;
      top: 135px;
      left: 540px;
      transform: rotate(0deg);
    }

    .emerald {
      background-color: #50C878;
      color: white;
      border: none;
      padding: 10px;
      font-size: 1em;
      cursor: pointer;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .container {
      position: relative;
    }
  </style>
</head>
<body>
  <div class="container">
    <canvas id="wheel" width="300" height="300"></canvas>
    <div id="pointer"></div>
    <div id="controls">
      <button id="spin" class="emerald" disabled>Spin</button>
      <button id="randomize">Randomize Entries</button>
      <button id="edit">Edit Entries</button>
    </div>
  </div>
  <div id="edit-box">
    <textarea id="entry-input"></textarea>
    <div id="save-cancel">
      <button id="save">Save</button>
      <button id="cancel">Cancel</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spin');
    const randomBtn = document.getElementById('randomize');
    const editBtn = document.getElementById('edit');
    const editBox = document.getElementById('edit-box');
    const entryInput = document.getElementById('entry-input');
    const saveBtn = document.getElementById('save');
    const cancelBtn = document.getElementById('cancel');

    let entries = ['Red', 'Blue', 'Green'];
    let colors = [];
    let angle = 0;
    let spinning = false;
    let spinStart = 0;
    let spinSpeed = 0;
    let slowing = false;

    function getColors(n) {
      const colorArray = [];
      for (let i = 0; i < n; i++) {
        const hue = (i * 360 / n) % 360;
        colorArray.push(`hsl(${hue}, 80%, 60%)`);
      }
      return colorArray;
    }

    function drawWheel() {
      const radius = canvas.width / 2;
      const num = entries.length;
      colors = getColors(num);
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < num; i++) {
        const start = angle + i * 2 * Math.PI / num;
        const end = angle + (i + 1) * 2 * Math.PI / num;
        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius, start, end);
        ctx.fillStyle = colors[i];
        ctx.fill();
        ctx.stroke();
        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate((start + end) / 2);
        ctx.fillStyle = '#000';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText(entries[i], radius - 10, 5);
        ctx.restore();
      }
    }

    function animate() {
      if (!spinning) return;
      const now = Date.now();
      const elapsed = (now - spinStart) / 1000;

      if (elapsed > 2 && !slowing) {
        slowing = true;
      }

      if (slowing) {
        spinSpeed *= 0.98;
        if (spinSpeed < 0.01) {
          spinning = false;
          spinBtn.disabled = false;
          randomBtn.disabled = entries.length < 2;
          editBtn.disabled = false;
        }
      }

      angle += spinSpeed;
      drawWheel();
      requestAnimationFrame(animate);
    }

    spinBtn.addEventListener('click', () => {
      if (entries.length < 2) return;
      spinSpeed = 0.3;
      spinStart = Date.now();
      spinning = true;
      slowing = false;
      spinBtn.disabled = true;
      randomBtn.disabled = true;
      editBtn.disabled = true;
      animate();
    });

    randomBtn.addEventListener('click', () => {
      for (let i = entries.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [entries[i], entries[j]] = [entries[j], entries[i]];
      }
      drawWheel();
    });

    editBtn.addEventListener('click', () => {
      editBox.style.display = 'flex';
      entryInput.value = entries.join('\n');
      spinBtn.disabled = true;
      randomBtn.disabled = true;
      editBtn.disabled = true;
    });

    saveBtn.addEventListener('click', () => {
      const lines = entryInput.value.split('\n').map(x => x.trim()).filter(x => x);
      entries = [...new Set(lines)];
      editBox.style.display = 'none';
      drawWheel();
      spinBtn.disabled = entries.length < 2;
      randomBtn.disabled = entries.length < 2;
      editBtn.disabled = false;
    });

    cancelBtn.addEventListener('click', () => {
      editBox.style.display = 'none';
      spinBtn.disabled = entries.length < 2;
      randomBtn.disabled = entries.length < 2;
      editBtn.disabled = false;
    });

    drawWheel();
    spinBtn.disabled = entries.length < 2;
    randomBtn.disabled = entries.length < 2;
  </script>
</body>
</html>
