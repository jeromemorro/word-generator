
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Random Wheel Selector</title>
  <style>
  /* === üß± Base Styles === */
  /* === Base Body Styling === */
    body {
      margin: 0;
      background-color: #121212;
      font-family: Arial, sans-serif;
      color: white;
    }

  /* === Light Mode Overrides === */
    body.light-mode {
      background-color: #f0f0f0;
      color: #000;
    }

  /* === ü™ü Window & Layout Containers === */
  /* === Main Window Container === */
    .window {
      width: 320px;
      margin-top: 10px;
      border: 1px solid #444;
      background-color: #000;
      box-shadow: 0 0 10px #222;
    }

  /* === Main Layout Flexbox === */
    .main-layout {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 50px;
    }

  /* === Wheel Container === */
    .wheel-container {
      position: relative;
      display: inline-block;
      width: 400px;
      height: 400px;
      margin-top: 40px;
      margin-left: 20px;
    }

  /* === üñºÔ∏è Canvas & Welcome Message === */
  /* === Canvas Styling === */
    canvas {
      margin-bottom: 1rem;
      display: block;
    }

  /* === Welcome Message Overlay === */
    .welcome-message {
      position: absolute;
      top: 55%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      font-size: 1.2rem;
      color: #ccc;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 30px 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px #000;
      z-index: 5;
      max-width: 540px;
      line-height: 1.6;
      white-space: nowrap;
    }

  /* === üéõÔ∏è Controls & Buttons === */
  /* === Controls Container === */
    .controls {
      display: flex;
      justify-content: center;
      gap: 50px;
    }

  /* === Generic Button Styling === */
    .controls button {
      display: flex;
      height: 30px;
      padding: 0 5px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      white-space: nowrap;
      align-items: center;
      justify-content: center;
    }

  /* === Content Container === */
    .content {
      height: 400px;
      border: 1px solid purple;
      margin: 10px;
      background-color: #121212;
      padding: 5px;
      box-sizing: border-box;
    }

  /* === üéØ Spin & Edit Buttons === */
  /* === Spin Button States === */
    #spinBtn:enabled {
      background-color: #50c878;
      color: white;
      cursor: pointer;
    }

    #spinBtn:disabled {
      background-color: #e9e9e9;
      color: #a8a8b2;
      cursor: default;
    }

  /* === Edit Button States === */
    #editBtn:enabled {
      background-color: #9370DB;
      color: white;
      cursor: pointer;
    }

    #editBtn:disabled {
      background-color: #e9e9e9;
      color: #a8a8b2;
      cursor: default;
    }

  /* === Hover Colors Based on Mode === */
    body:not(.light-mode) #spinBtn:hover:enabled {
      background-color: #6fd290;
    }

    body.light-mode #spinBtn:hover:enabled {
      background-color: #a0e6c0;
    }

    body:not(.light-mode) #editBtn:hover:enabled {
      background-color: #A080E0;
    }

    body.light-mode #editBtn:hover:enabled {
      background-color: #7A5FC0;
    }

  /* === üß≠ Wheel Title & Arrow === */
  /* === Wheel Title Container === */
    #wheelTitleContainer {
      display: flex;
      align-items: center;
      font-size: 15px;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 20px;
    }

    #wheelTitle {
      display: inline-block;
    }

    #titleInput {
      display: inline-block;
      font-size: 1em;
    }

    #editTitleBtn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1em;
      cursor: pointer;
      vertical-align: middle;
      text-align: center;
      line-height: 1;
      opacity: 0.3;           /* make it faint */
      transition: opacity 0.3s ease; /* smooth transition */
    }

    #editTitleBtn:hover {
      opacity: 1;
      transform: scale(1.2);  /* subtle grow effect */
    }

  /* === Arrow Pointer === */
    #arrow {
      position: absolute;
      top: 60%;
      left: 98%;
      transform: translateY(-50%) rotate(180deg);
      width: 0;
      height: 0;
      border-top: 14px solid transparent;
      border-bottom: 14px solid transparent;
      border-left: 28px solid black;
      z-index: 10;
      cursor: pointer;
    }

    #arrow::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -26px;
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent;
      border-left: 20px solid red;
      z-index: -1;
    }
  /* === Arrow Tooltip === */
    #arrowTooltip {
      position: fixed;
      background-color: #555;
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      white-space: nowrap;
      font-size: 11px;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 1001;
      transform: translateX(-50%) translateY(-2px);
    }

    #arrowTooltip::before {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 6px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
      opacity: 1;
      z-index: 1000;
    }

  /* === üß© Title Bar & Icon Bar === */
  /* === Title Bar Styling === */
    .title-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2px 6px;
      background-color: #222;
      border-bottom: 1px solid #444;
      height: 32px;
    }

    .title-bar .left {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }

    .title-bar .right {
      cursor: pointer;
      width: 24px;
      height: 24px;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
    }

    .title-bar .right:hover {
      background-color: #333;
    }

  /* === Icon Bar Styling === */
    .icon-bar {
      display: flex;
      gap: 4px;
      padding: 2px 6px;
      background-color: #1a1a1a;
      border-bottom: 1px solid #444;
      height: 28px;
    }

    .icon-group {
      display: flex;
      gap: 1px;
    }

    .icon-group + .icon-group {
      margin-left: 6px;
    }

  /* === üñ±Ô∏è Icon Wrapper & Tooltip === */
  /* === Icon Wrapper === */
    .icon-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      width: 24px;
      height: 24px;
      padding-top: 2px;
      border-radius: 6px;
    }

    .icon-wrapper:hover {
      background-color: #333;
    }

  /* === Tooltip Styling === */
    .icon-wrapper::after {
      content: attr(data-tooltip);
      position: absolute;
      top: 130%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #555;
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      white-space: nowrap;
      font-size: 11px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 10;
    }

    .icon-wrapper::before {
      content: '';
      position: absolute;
      top: 120%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 6px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 9;
    }

    .icon-wrapper.disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    .icon-wrapper:hover::after,
    .icon-wrapper:hover::before {
      animation: showTooltip 0s linear 2s forwards;
    }

  /* === Tooltip Animation === */
    @keyframes showTooltip {
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(2px);
      }
    }

  /* === üìù Editor & Display === */
  /* === Editor Window Visibility === */
    #editorWindow {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
      height: 100%;
    }

    #editorWindow.visible {
      opacity: 1;
      visibility: visible;
    }

  /* === Editor Container === */
    #editor-container {
      position: relative;
      width: 100%;
      height: 100%;
      border: 1px solid #391C6B;
      font-family: monospace;
      font-size: 16px;
      line-height: 1.4em;
      overflow: hidden;
    }

  /* === Editable Area === */
    #editable-area {
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 5px;
      box-sizing: border-box;
      outline: none;
      white-space: pre;
      overflow-wrap: break-word;
      overflow-x: auto;
      overflow-y: auto;
      font-size: 16px;
      line-height: 1.4em;
      pointer-events: auto;
      position: relative;
      z-index: 1;
    }

    #editable-area:empty::before {
      content: "Enter up to 50 lines...";
      color: #888;
      pointer-events: none;
    }

  /* === Formatted Display === */
    #formatted-display {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
      opacity: 0;
      transition: opacity 0.3s ease;
      overflow-x: auto;
      overflow-y: auto;
      cursor: pointer;
      font-size: 16px;
      line-height: 1.4em;
      white-space: pre;
      padding: 5px;
      box-sizing: border-box;
      pointer-events: none;
    }

    #formatted-display.show {
      opacity: 1;
      pointer-events: auto;
    }

    #formatted-display.placeholder::before {
      content: "Enter up to 50 lines...";
      color: #888;
      font-style: italic;
      position: absolute;
      top: 5px;
      left: 5px;
      pointer-events: none;
      font-family: monospace;
      font-size: 16px;
      line-height: 1.4em;
    }

  /* === üßµ Line Styling & Tags === */
  /* === Line Styling === */
    .line {
      position: relative;
      white-space: pre;
      width: max-content;
      min-width: 100%;
      display: block;
      line-height: 1.4em;
      margin: 0;
    }

    .line:nth-child(even) {
      background-color: #424242;
    }

    .line:nth-child(odd) {
      background-color: #2D2D2D;
    }

  /* === Insertion Line === */
    .insertion-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background-color: #391C6B;
      z-index: 10;
    }

  /* === Color Tag === */
    .color-tag {
      position: absolute;
      right: 4px;
      top: 2px;
      width: 24px;
      height: 16px;
      background-color: #ffcc00;
      border: 1px solid #999;
      border-radius: 999px;
      cursor: pointer;
    }

    #toggle-color-mode.active {
      background-color: #FFD700;
      border: 1px solid #999;
      color: #000;
    }

  /* === üí° Light Mode Overrides (Extended) === */
    body.light-mode .window {
      background-color: #fff;
      border-color: #ccc;
      box-shadow: 0 0 10px #aaa;
    }

    body.light-mode .title-bar {
      background-color: #ddd;
      border-bottom: 1px solid #ccc;
    }

    body.light-mode .icon-bar {
      background-color: #eee;
      border-bottom: 1px solid #ccc;
    }

    body.light-mode .icon-wrapper:hover {
      background-color: #ccc;
    }

    body.light-mode #toggle-color-mode.active {
      background-color: #FFB800;
      color: #000;
    }

    body.light-mode .content {
      background-color: #f9f9f9;
      border-color: #ccc;
    }

    body.light-mode #editor-container {
      border-color: #999;
    }

    body.light-mode #editable-area {
      background-color: #fff;
      color: #000;
    }

    body.light-mode #formatted-display {
      background-color: #fff;
      color: #000;
    }

    body.light-mode .line:nth-child(even) {
      background-color: #f0f0f0;
    }

    body.light-mode .line:nth-child(odd) {
      background-color: #e0e0e0;
    }

    body.light-mode .color-tag {
      border-color: #666;
    }

    body.light-mode #formatted-display.placeholder::before {
      color: #666;
    }

  /* === üßæ Result Dialog === */
  /* === Dialog Container === */
    #resultDialog {
      position: fixed;
      left: 100px;
      top: 100px;
      transform: none;
      padding: 0;
      margin: 0;
      border: none;
      border-radius: 8px;
      background-color: #1A1A1A;
      color: white;
      box-shadow: 0 0 10px #000;
      z-index: 1000;
      width: 300px;
      height: auto;
      overflow: visible;
    }

  /* === Dialog Title Bar === */
    #resultDialog .title-bar {
      background-color: #222222;
      padding: 6px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      border-bottom: 1px solid #444;
    }

  /* === Dialog Content === */
    #resultDialog .dialog-content {
      padding: 20px;
      text-align: center;
      background-color: #1A1A1A;
      overflow: visible;
    }

  /* === Dialog Buttons === */
    #resultDialog .dialog-buttons {
      display: flex;
      justify-content: space-between;
      position: relative;
      top: 10px;
    }

    #resultDialog .dialog-buttons .icon-wrapper {
      width: auto;
      height: auto;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 14px;
      background-color: #444;
      color: white;
      cursor: pointer;
    }

    #resultDialog .dialog-buttons .icon-wrapper.disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    #resultDialog .dialog-buttons .icon-wrapper:hover {
      background-color: #666;
    }

/* === Confirmation Dialog === */
/* === Dialog Container === */
#confirmDialog {
  position: fixed;
  left: 100px;
  top: 100px;
  transform: none;
  padding: 0;
  margin: 0;
  border: none;
  border-radius: 8px;
  background-color: #1A1A1A;
  color: white;
  box-shadow: 0 0 10px #000;
  z-index: 10000;
  width: 300px;
  height: auto;
  overflow: visible;
  max-height: 180px;
}

 /* === Dialog Title Bar === */
#confirmDialog .title-bar {
  background-color: #222;
  padding: 6px 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
  border-bottom: 1px solid #444;
}

 /* === Dialog Content === */
#confirmDialog .dialog-content {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 12px;
  padding: 20px;
}

/* === Dialog Text === */
#confirmDialogText {
  flex: 1;
  text-align: left;
}

/* === Dialog Question Icon === */
#confirmDialog .question-icon {
  font-size: 22px;
  color: white;
  border: 2px solid #800080;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  line-height: 36px;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

  /* === Dialog Buttons === */
#confirmDialog .dialog-buttons.compact {
  display: flex;
  justify-content: center;
  gap: 50px;
  padding: 10px;
}

#confirmDialog .dialog-buttons.compact button {
  padding: 6px 16px;
  font-size: 14px;
  border-radius: 8px;
  border: none;
  background-color: #444;
  color: white;
  cursor: pointer;
}

#confirmDialog .dialog-buttons.compact button:hover {
  background-color: #666;
}


  /* === Highlighted Entry === */
    .highlighted-entry {
      background-color: #800080;
      padding: 2px 6px;
      border-radius: 4px;
      display: inline-block;
    }

  /* === Light Mode Dialog Overrides === */
    body.light-mode #resultDialog {
      background-color: #fff;
      color: #000;
    }

    body.light-mode #resultDialog .dialog-buttons .icon-wrapper {
      background-color: #ddd;
      color: #000;
    }

    body.light-mode #resultDialog .dialog-buttons .icon-wrapper:hover {
      background-color: #bbb;
    }

    body.light-mode #resultDialog .title-bar {
      background-color: #ddd;
      border-bottom: 1px solid #ccc;
    }

    body.light-mode #resultDialog .dialog-content {
      background-color: #fff;
      color: #000;
    }

    body.light-mode .highlighted-entry {
      background-color: #F0F0F0;
      color: #000;
    }

/* === Light Mode Dialog Overrides === */
body.light-mode #confirmDialog {
  background-color: #fff;
  color: #000;
}

body.light-mode #confirmDialog .dialog-buttons.compact button {
  background-color: #ddd;
  color: #000;
}

body.light-mode #confirmDialog .dialog-buttons.compact button:hover {
  background-color: #bbb;
}

body.light-mode #confirmDialog .title-bar {
  background-color: #ddd;
  border-bottom: 1px solid #ccc;
}

body.light-mode #confirmDialog .dialog-content {
  background-color: #fff;
  color: #000;
}

body.light-mode #confirmDialog .question-icon {
  color: black;
  border-color: black;
}

  </style>
</head>
<body>

<div class="main-layout">
  <div class="wheel-container">
    <div id="titleWrapper">
      <div id="wheelTitleContainer">
        <span id="wheelTitle">Random Entry Selector</span>
        <!-- <span id="editTitleBtn" title="Edit title">‚úèÔ∏è</span> -->
        <div class="icon-wrapper" id="editTitleBtn" data-tooltip="Edit title">‚úèÔ∏è</div>
        <input type="text" id="titleInput" style="display:none; font-size:1em;" />
      </div>
    </div>

    <div id="welcomeMessage" class="welcome-message">
      <h2>üéâWelcome!</h2>
      Click <em>Edit</em> to enter up to 50 entries.<br>
      Then click <em>Spin</em> to randomly select one!<br><br>
    </div>

    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <div id="arrow"></div>
    <div id="arrowTooltip">Click to show result</div>
    <!-- Tooltip for truncated wheel entries -->
    <div id="wheelTooltip" class="icon-wrapper" data-tooltip="" style="
      position: fixed;
      width: 24px;
      height: 24px;
      font-size: 18px;
      opacity: 0;
      pointer-events: none;
      z-index: 1000;
    "></div>

    <div class="controls">
      <div class="icon-wrapper" data-tooltip="Spin the wheel">
        <button id="spinBtn" disabled>üåÄSpin</button>
      </div>
      <div class="icon-wrapper" data-tooltip="Edit entries">
        <button id="editBtn">‚öôÔ∏èEdit</button>
      </div>
    </div>
    <dialog id="resultDialog">
      <div class="title-bar">
        <div class="left">üéØ Result</div>
        <div class="icon-wrapper right" id="closeDialogBtn" data-tooltip="Close dialog">‚úñÔ∏è</div>
      </div>
      <div class="dialog-content">
        <p id="resultText"></p>
        <div class="dialog-buttons">
          <button class="icon-wrapper" id="removeBtn" data-tooltip="Remove entry">Remove</button>
          <button class="icon-wrapper" id="okBtn" data-tooltip="Confirm result">OK</button>
        </div>
      </div>
    </dialog>
  </div>
  <div class="window" id="editorWindow">
    <div class="title-bar">
      <div class="left">
        <span>‚öôÔ∏è</span>
        <span>Edit Entries</span>
      </div>
      <div class="icon-wrapper right" id="closeEditorBtn" data-tooltip="Close window">‚úñÔ∏è</div>
    </div>
    <div class="icon-bar">
      <div class="icon-group">
        <div class="icon-wrapper" data-tooltip="Import from file">üì•</div>
        <input type="file" id="importFile" accept=".csv" style="display:none;" />
        <div class="icon-wrapper disabled" id="exportFile" data-tooltip="Export to file">üì§</div>
      </div>
      <div class="icon-group">
        <div class="icon-wrapper disabled" id="toggle-color-mode" data-tooltip="Edit colors">üé®</div>
        <div class="icon-wrapper disabled" id="toggle-sort-order" data-tooltip="Sort entries">üî°</div>
        <div class="icon-wrapper disabled" id="deleteAllEntries" data-tooltip="Delete all entries">üóëÔ∏è</div>
      </div>
      <div style="flex-grow: 1;"></div> <!-- Spacer to push next icon to the right -->
      <div class="icon-wrapper" id="toggle-dark-mode" data-tooltip="Toggle dark mode">üåì</div>
    </div>
    <div class="content">
      <div id="editor-container">
        <div id="editable-area" contenteditable="true" spellcheck="true"></div>
        <div id="formatted-display"></div>
      </div>
    </div>
    <dialog id="confirmDialog">
      <div class="title-bar">
        <span id="confirmDialogTitle">Confirm</span>
        <div class="icon-wrapper" data-tooltip="Close dialog">
          <span id="closeConfirmDialogBtn" class="right">‚úñÔ∏è</span>
        </div>
      </div>
      <div class="dialog-content">
        <div class="question-icon">‚ùî</div>
        <div id="confirmDialogText">Are you sure?</div>
      </div>
      <div class="dialog-buttons compact">
        <div class="icon-wrapper" data-tooltip="Confirm action">
          <button id="confirmYesBtn">Yes</button>
        </div>
        <div class="icon-wrapper" data-tooltip="Cancel action">
          <button id="confirmNoBtn" autofocus>No</button>
        </div>
      </div>
    </dialog>
  </div>
</div>
<script>
class Wheel {
  constructor(container) {
    // === State Variables ===
    this.container = container;
    this.entries = [];
    this.angle = 0;
    this.spinning = false;
    this.selectedEntry = "";
    this.colorEditMode = false;
    this.isDraggingDialog = false;
    this.dragTarget = null;
    this.offsetX = 0;
    this.offsetY = 0;

    // === DOM Elements ===
    this.wheelTitle = container.querySelector(".wheel-title");
    this.titleInput = container.querySelector(".title-input");
    this.editableArea = container.querySelector(".editable-area");
    this.canvas = container.querySelector(".wheel-canvas");
    this.ctx = this.canvas.getContext("2d");
    this.spinBtn = container.querySelector(".spin-btn");
    this.editBtn = container.querySelector(".edit-btn");
    this.closeEditorBtn = container.querySelector(".close-editor-btn");
    this.toggleColorBtn = container.querySelector(".toggle-color-btn");
    this.deleteAllBtn = container.querySelector(".delete-all-btn");
    this.importFileInput = container.querySelector(".import-file");
    this.exportFileBtn = container.querySelector(".export-file-btn");
    this.resultDialog = container.querySelector(".result-dialog");
    this.resultText = container.querySelector(".result-text");
    this.okBtn = container.querySelector(".ok-btn");
    this.removeBtn = container.querySelector(".remove-btn");
    this.resultTitleBar = this.resultDialog.querySelector(".title-bar");

    this.init();
  }

  // === Wheel Methods ===
  drawWheel() {
    const ctx = this.ctx;
    const canvas = this.canvas;
    const count = this.entries.length;
    const radius = canvas.width / 2;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (!count) return;

    const arc = (2 * Math.PI) / count;

    this.entries.forEach((entry, i) => {
      const start = this.angle + i * arc;
      const midAngle = start + arc / 2;

      // Draw slice
      ctx.beginPath();
      ctx.moveTo(radius, radius);
      ctx.arc(radius, radius, radius, start, start + arc);
      ctx.fillStyle = entry.color || this.getRandomColor();
      ctx.fill();
      ctx.strokeStyle = "#fff";
      ctx.stroke();

      // Draw text
      ctx.save();
      ctx.translate(radius, radius);
      ctx.rotate(midAngle);
      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      ctx.font = `bold 20px sans-serif`;
      ctx.fillStyle = this.getContrastColor(entry.color || "#000");
      ctx.fillText(entry.name, radius - 10, 0);
      ctx.restore();
    });
  }

  spin() {
    if (this.spinning || !this.entries.length) return;
    this.spinning = true;

    const spins = 5 + Math.random() * 5; // Random spins
    const randomIndex = Math.floor(Math.random() * this.entries.length);
    const arc = (2 * Math.PI) / this.entries.length;
    const targetAngle = 2 * Math.PI * spins - randomIndex * arc - arc / 2;

    const duration = 4000; // 4 seconds
    const start = performance.now();
    const initialAngle = this.angle;

    const animate = (time) => {
      const elapsed = time - start;
      const progress = Math.min(elapsed / duration, 1);
      this.angle = initialAngle + (targetAngle - initialAngle) * this.easeOutCubic(progress);
      this.drawWheel();
      if (progress < 1) requestAnimationFrame(animate);
      else {
        this.spinning = false;
        this.selectedEntry = this.entries[randomIndex];
        this.showResult(this.selectedEntry);
      }
    };

    requestAnimationFrame(animate);
  }

  easeOutCubic(t) {
    return 1 - Math.pow(1 - t, 3);
  }

  showResult(entry) {
    this.resultText.textContent = entry.name;
    this.resultDialog.style.display = "block";
  }

  closeResult() {
    this.resultDialog.style.display = "none";
  }

  // === Editor Methods ===
  openEditor() {
    this.editableArea.value = this.entries.map(e => e.name).join("\n");
    this.container.querySelector(".editor-window").style.display = "block";
  }

  closeEditor() {
    this.container.querySelector(".editor-window").style.display = "none";
    this.entries = this.editableArea.value.split("\n").filter(n => n.trim()).map(n => ({ name: n.trim(), color: this.getRandomColor() }));
    this.drawWheel();
  }

  toggleColorEditMode() {
    this.colorEditMode = !this.colorEditMode;
  }

  deleteAllEntries() {
    this.entries = [];
    this.drawWheel();
  }

  importEntries(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      this.entries = reader.result.split("\n").filter(n => n.trim()).map(n => ({ name: n.trim(), color: this.getRandomColor() }));
      this.drawWheel();
    };
    reader.readAsText(file);
  }

  exportEntries() {
    const data = this.entries.map(e => e.name).join("\n");
    const blob = new Blob([data], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "wheel-entries.txt";
    a.click();
    URL.revokeObjectURL(url);
  }

  // === Dragging Dialog ===
  startDrag(e, dialog) {
    e.preventDefault();
    this.isDraggingDialog = true;
    this.dragTarget = dialog;
    this.offsetX = e.clientX - dialog.offsetLeft;
    this.offsetY = e.clientY - dialog.offsetTop;
  }

  stopDrag() {
    this.isDraggingDialog = false;
    this.dragTarget = null;
  }

  onDrag(e) {
    if (!this.isDraggingDialog || !this.dragTarget) return;
    this.dragTarget.style.left = `${e.clientX - this.offsetX}px`;
    this.dragTarget.style.top = `${e.clientY - this.offsetY}px`;
  }

  // === Utility Methods ===
  getRandomColor() {
    return "#" + Math.floor(Math.random()*16777215).toString(16).padStart(6,"0");
  }

  getContrastColor(hex) {
    hex = hex.replace("#", "");
    const r = parseInt(hex.substr(0,2),16);
    const g = parseInt(hex.substr(2,2),16);
    const b = parseInt(hex.substr(4,2),16);
    const brightness = (r*299+g*587+b*114)/1000;
    return brightness < 128 ? "#fff" : "#000";
  }

  init() {
    this.drawWheel();

    this.spinBtn.addEventListener("click", () => this.spin());
    this.editBtn.addEventListener("click", () => this.openEditor());
    this.closeEditorBtn.addEventListener("click", () => this.closeEditor());
    this.toggleColorBtn.addEventListener("click", () => this.toggleColorEditMode());
    this.deleteAllBtn.addEventListener("click", () => this.deleteAllEntries());
    this.importFileInput.addEventListener("change", (e) => this.importEntries(e));
    this.exportFileBtn.addEventListener("click", () => this.exportEntries());
    this.okBtn.addEventListener("click", () => this.closeResult());
    this.removeBtn.addEventListener("click", () => {
      if (!this.selectedEntry) return;
      this.entries = this.entries.filter(e => e !== this.selectedEntry);
      this.closeResult();
      this.drawWheel();
    });

    // Dragging result dialog
    this.resultTitleBar.addEventListener("mousedown", e => this.startDrag(e, this.resultDialog));
    document.addEventListener("mouseup", () => this.stopDrag());
    document.addEventListener("mousemove", e => this.onDrag(e));
  }
}

// === Initialize Multiple Wheels ===
document.addEventListener("DOMContentLoaded", () => {
  const wheel1 = new Wheel(document.getElementById("wheelContainer1"));
  const wheel2 = new Wheel(document.getElementById("wheelContainer2"));
});
</script>
</body>
</html>
