<!DOCTYPE html>
<html>
<style>
#progress-bar {
  width: 100%;
  background-color: DimGray;
}

#progress-indicator {
  width: 0%; 
  height: 30px;
  background-color: Lime;
}

.generator-toggle-button {
  background-color: red;
  color: white;
  font-size: 16px;
  font-weight: bold;
}

.definition-display {
  background-color: black;
  border: 1px solid white;
  color: white;
  /* display: none; */ 
  flex: 1;
  font-family: inherit;
  font-size: 16px;
  padding: 10px;
  resize: none;
  tab-size: 1;
  width: 100%;
}

</style>
<body>

<div id="word-container">
    <div id="word-display" class="word-display">Let's Goooo!</div>
</div>
<div id="progress-bar">
    <div id="progress-indicator"></div>
</div>
<div id="interval-container">
    <label for="interval-select" class="label-text">Seconds between words:</label>
    <input type="number" id="interval-select" min="1" max="30" value="5" required>
</div>
<br>
<button id="generator-toggle-button" class="generator-toggle-button">Start generator</button>
<br>
<br>
<div id="syllables-container">
    <label for="syllables-select" class="label-text">Syllables per word:</label>
    <select id="syllables-select">
        <option value="0" selected>Any</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4 or more</option>
    </select>
</div>
<div id="obscure-words-toggle-container">
    <label for="obscure-words-toggle" class="label-text">Show obscure words:</label>
    <input type="checkbox" id="obscure-words-toggle">
</div>
<div id="definitions-toggle-container">
    <label for="definitions-toggle" class="label-text">Show definitions:</label>
    <input type="checkbox" id="definitions-toggle">
</div>
<div id="definition-display-container">
    <textarea id="definition-display" class="definition-display" readonly rows="8"></textarea>
</div>
<br>
<br>
<div id="playlist-container">
    <iframe src="https://www.youtube.com/embed/videoseries?list=PLLasX02E8BPCkqipgpNf9wHM07Kl1-Y8a"></iframe>
</div>
<div id="load-playlist-container">
    <input type="text" id="load-playlist-input" placeholder="Enter YouTube playlist ID">
    <button id="load-playlist-button" class="load-playlist-button">Load Playlist</button>
</div>
 

<script>

window.addEventListener('DOMContentLoaded', function() {
  var wordDisplay = document.getElementById('word-display');
  var intervalSelect = document.getElementById('interval-select');
  var generatorToggle = document.getElementById('generator-toggle-button');
  var progressIndicator = document.getElementById('progress-indicator');

  var wordIntervalId;
  var progressIntervalId;
  var progressWidth = 0;
  var isProgressUpdating = false;
  var isWordGenerationRunning = false;
  var intervalSelectValue = intervalSelect.value;
  var words = []; // Array to store the word entries from the JSON file


  intervalSelect.dataset.previousValue = intervalSelectValue;
  generatorToggle.addEventListener('click', toggleWordGeneration);
  intervalSelect.addEventListener('change', handleOptionChange);
  intervalSelect.addEventListener('input', handleOptionInput);

  fetch('words-temp.json')
    .then(function(response) {
      return response.json();
    })
    .then(function(data) {
      words = data;
      startWordGeneration();
      generatorToggle.textContent = 'Stop generator';
      generatorToggle.style.backgroundColor = 'limegreen';
    })
    .catch(function(error) {
      console.error('Error fetching words:', error);
    });

  function generateRandomWord() {
    var filteredWords = words;

    // Generate a random word from the filtered list
    if (filteredWords.length > 0) {
      var randomNumber = Math.floor(Math.random() * filteredWords.length);
      var randomWord = filteredWords[randomNumber].w;

      if (!isProgressUpdating) {
        wordDisplay.textContent = randomWord;
        startProgressIndicator();      
      }
    } else {
      wordDisplay.textContent = 'No matching words found.';
    }
  }



  function startWordGeneration() {
    var interval = intervalSelectValue * 1000; // Convert selected value to milliseconds
    generateRandomWord(); // Generate the first word immediately
    wordIntervalId = setInterval(generateRandomWord, interval);
    isWordGenerationRunning = true;
  }

  function stopWordGeneration() {
    clearInterval(wordIntervalId);
    wordIntervalId = null;
    isWordGenerationRunning = false;
    resetProgressIndicator();
  }

  function toggleWordGeneration() {
    if (isWordGenerationRunning) {
      // Word generation is currently running, stop it
      stopWordGeneration();
      generatorToggle.textContent = 'Start generator';
      generatorToggle.style.backgroundColor = 'red';
    } else {
      // Word generation is currently stopped, start it
      startWordGeneration();
      generatorToggle.textContent = 'Stop generator';
      generatorToggle.style.backgroundColor = 'limegreen';
    }
  }

  function handleOptionChange() {
    if (isWordGenerationRunning) {
      if (intervalSelect.checkValidity() ) {
        // Word generation is currently running, update the interval duration
        var interval = intervalSelectValue * 1000; // Convert selected value to milliseconds
        clearInterval(wordIntervalId);
        wordIntervalId = setInterval(generateRandomWord, interval);
        resetProgressIndicator();
      }
    }
  }

function handleOptionInput() {
  var previousValue = intervalSelect.dataset.previousValue || intervalSelectValue; // Store the previous value

  if (!intervalSelect.checkValidity()) {
    intervalSelect.reportValidity(); // Display the warning message
    
    // Revert the value after a short delay
    setTimeout(function() {
      intervalSelect.value = previousValue; // Restore the previous value
    }, 2000);
  } else {
    intervalSelect.dataset.previousValue = intervalSelect.value; // Update the previous value
    intervalSelectValue = intervalSelect.value;
  }
}

  function startProgressIndicator() {
    progressWidth = 100;
    progressIndicator.style.width = progressWidth + '%';
    progressIntervalId = setInterval(updateProgressIndicator, 1000);
    isProgressUpdating = true;
  }

  function stopProgressIndicator() {
    clearInterval(progressIntervalId);
    progressIntervalId = null;
    isProgressUpdating = false;
  }

  function updateProgressIndicator() {
    progressWidth -= 100 / (intervalSelectValue - 1);
    progressIndicator.style.width = progressWidth + '%';
    if (progressWidth < 0) {
      stopProgressIndicator();
      generateRandomWord();
    }
  }

  function resetProgressIndicator() {
    stopProgressIndicator();
    progressWidth = 0;
    progressIndicator.style.width = progressWidth + '%';
  }

});

</script>
</body>
</html>
