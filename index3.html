<!DOCTYPE html>
<html>
<style>
#progress-bar {
  width: 100%;
  background-color: DimGray;
}

#progress-indicator {
  width: 0%; 
  height: 30px;
  background-color: Lime;
}

.load-playlist-button {
  background-color: #993399;
  border-width: thin;
  color: white;
  flex-shrink: 0;
  font-size: 16px;
  font-weight: bold;
}

.load-playlist-button:disabled {
  /* Styles for the disabled state */
  opacity: 0.5;
}

/*
.generator-toggle-button {
  background-color: red;
  border-width: thin;
  color: white;
  font-size: 16px;
  font-weight: bold;
}
*/

.generator-toggle-button {
  background-color: red;
  border-width: thin;
  padding: 0px 5px;
}

.generator-toggle-button-text {
  color: white;
  font-size: 16px;
  font-weight: bold; 
  left: -3px;
  position: relative;
  top: 1px;
  vertical-align: middle;
}

.green-play-icon {
  display: inline-block;
  width: 0px;
  height: 0px;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-left: 9px solid lime;
  margin-right: 5px;
  vertical-align: middle;
}

.red-stop-icon {
  display: inline-block;
  width: 10px;
  height: 10px;
  background-color: red;
  margin-right: 5px;
  vertical-align: middle;
}

.definitions-display {
  background-color: black;
  border: 1px solid white;
  color: white;
  display: none;  
  flex: 1;
  font-family: inherit;
  font-size: 16px;
  padding: 10px;
  resize: none;
  tab-size: 1;
  width: 100%;
}

</style>
<body>

<div id="word-container">
    <div id="word-display" class="word-display">Let's Goooo!</div>
</div>
<div id="progress-bar">
    <div id="progress-indicator"></div>
</div>
<div id="interval-container">
    <label for="interval-select" class="label-text">Seconds between words:</label>
    <input type="number" id="interval-select" min="1" max="30" value="5" required>
</div>
<br>
<button id="generator-toggle-button" class="generator-toggle-button">
  <span class="green-play-icon"></span>
  <span class="generator-toggle-button-text">Start generator</span>
</button>
<br>
<br>
<div id="syllables-container">
    <label for="syllables-select" class="label-text">Syllables per word:</label>
    <select id="syllables-select">
        <option value="0" selected>Any</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4 or more</option>
    </select>
</div>
<div id="obscure-words-toggle-container">
    <label for="obscure-words-toggle" class="label-text">Show obscure words:</label>
    <input type="checkbox" id="obscure-words-toggle">
</div>
<div id="definitions-toggle-container">
    <label for="definitions-toggle" class="label-text">Show definitions:</label>
    <input type="checkbox" id="definitions-toggle">
</div>
<div id="definitions-display-container">
    <textarea id="definitions-display" class="definitions-display" readonly rows="8"></textarea>
</div>
<br>
<br>
<div id="playlist-container">
    <iframe id="playlist-frame" src="https://www.youtube.com/playlist?list=PLCSL5JAg7difkLp4Rl_QNXHgW06rkB2tc"></iframe>
</div>
<div id="load-playlist-container">
    <input type="text" id="load-playlist-input" placeholder="Enter YouTube playlist ID">
    <button id="load-playlist-button" class="load-playlist-button" disabled>Load Playlist</button>
</div>
 

<script>
window.addEventListener('DOMContentLoaded', function() {
  // Get references to HTML elements
  var wordDisplay = document.getElementById('word-display');
  var intervalSelect = document.getElementById('interval-select');
  var generatorToggle = document.getElementById('generator-toggle-button');
  var iconSpan = generatorToggle.querySelector('.green-play-icon');
  var textSpan = generatorToggle.querySelector('.generator-toggle-button-text');
  var progressIndicator = document.getElementById('progress-indicator');
  var definitionsToggle = document.getElementById('definitions-toggle');
  var definitionsDisplay = document.getElementById('definitions-display');
  var syllablesSelect = document.getElementById('syllables-select');
  var obscureWordsToggle = document.getElementById('obscure-words-toggle');
  var playlistFrame = document.getElementById('playlist-frame');
  var loadPlaylistInput = document.getElementById('load-playlist-input');
  var loadPlaylistButton = document.getElementById('load-playlist-button');

  // Declare variables
  var wordIntervalId; // ID for the word generation interval
  var progressIntervalId; // ID for the progress indicator interval
  var progressWidth; // Current width of the progress indicator
  var progressIteration; // Current iteration of the progress indicator
  var isProgressUpdating = false; // Flag to track if progress indicator is updating
  var isWordGenerationRunning = false; // Flag to track if word generation is running
  var intervalSelectValue = intervalSelect.value; // Selected value of the interval

  // Event listeners
  generatorToggle.addEventListener('click', toggleWordGeneration);
  intervalSelect.addEventListener('change', handleOptionChange);
  intervalSelect.addEventListener('input', handleOptionInput);
  definitionsToggle.addEventListener('change', toggleDefinitions);
  syllablesSelect.addEventListener('change', handleOptionChange);
  obscureWordsToggle.addEventListener('change', handleOptionChange);
  loadPlaylistInput.addEventListener('input', handlePlaylistInput);
  loadPlaylistButton.addEventListener('click', handleLoadPlaylistButtonClick);
  window.addEventListener('resize', adjustGeneratorToggleButtonHeight);

  // Adjust generator toggle button height on page load
  adjustGeneratorToggleButtonHeight();

  // Store the previous value of the interval select
  intervalSelect.dataset.previousValue = intervalSelectValue;

  // Fetch the word data from a JSON file
  fetch('words-temp.json')
    .then(function(response) {
      return response.json();
    })
    .then(function(data) {
      words = data; // Store the fetched word entries in the 'words' array
      startWordGeneration(); // Start word generation
      displayStartGenerator(false);
    })
    .catch(function(error) {
      console.error('Error fetching words:', error);
    });

  // Function to adjust generator toggle button height
  function adjustGeneratorToggleButtonHeight() {
    generatorToggle.style.height = loadPlaylistButton.offsetHeight + 'px';
  }

  // Generate a random word from the filtered list
  function generateRandomWord() {
    var filteredWords = words;

    // Filter words based on selected syllables
    var selectedSyllables = syllablesSelect.value;
    if (selectedSyllables !== '0') {
      filteredWords = filteredWords.filter(function(word) {
        return word.s == selectedSyllables;
      });
    }

    // Filter words based on obscure words checkbox
    if (!obscureWordsToggle.checked) {
      filteredWords = filteredWords.filter(function(word) {
        return word.c == 1;
      });
    }

    // Generate a random word from the filtered list
    if (filteredWords.length > 0) {
      var randomNumber = Math.floor(Math.random() * filteredWords.length);
      var randomWord = filteredWords[randomNumber].w;
      var definitions = filteredWords[randomNumber].d;

      if (!isProgressUpdating) {
        wordDisplay.textContent = randomWord;
        definitionsDisplay.value = definitions;
        startProgressIndicator();      
      }
    } else {
      wordDisplay.textContent = 'No matching words found.';
      definitionsDisplay.value = '';
    }
  }

  // Start word generation
  function startWordGeneration() {
    var interval = intervalSelectValue * 1000; // Convert selected value to milliseconds
    generateRandomWord(); // Generate the first word immediately
    wordIntervalId = setInterval(generateRandomWord, interval);
    isWordGenerationRunning = true;
  }

  // Stop word generation
  function stopWordGeneration() {
    clearInterval(wordIntervalId);
    wordIntervalId = null;
    isWordGenerationRunning = false;
    resetProgressIndicator();
  }

  // Toggle word generation on button click
  function toggleWordGeneration() {
    if (isWordGenerationRunning) {
      // Word generation is currently running, stop it
      stopWordGeneration();
      displayStartGenerator(true);
    } else {
      // Word generation is currently stopped, start it
      startWordGeneration();
      displayStartGenerator(false);
    }
  }

  function displayStartGenerator(isTrue) {
    if (isTrue) {
      iconSpan.classList.remove('red-stop-icon');
      iconSpan.classList.add('green-play-icon');
      textSpan.textContent = 'Start generator';
      generatorToggle.style.backgroundColor = 'red';
    } else {
      iconSpan.classList.remove('green-play-icon');
      iconSpan.classList.add('red-stop-icon');
      textSpan.textContent = 'Stop generator';
      generatorToggle.style.backgroundColor = 'limegreen';
    }
  }

  // Toggle definitions display
  function toggleDefinitions() {
    var computedStyles = window.getComputedStyle(definitionsDisplay);
    var display = computedStyles.getPropertyValue('display');

    if (display === 'none') {
      // Show the definitions display 
      definitionsDisplay.style.display = 'block';
    } else {
      // Hide the definitions display 
      definitionsDisplay.style.display = 'none';
    }
  }

  // Update the interval duration
  function handleOptionChange() {
    if (isWordGenerationRunning) {
      intervalSelectValue = intervalSelect.value;
    }
  }

  // Handle input of interval selection
  function handleOptionInput() {
    var previousValue = intervalSelect.dataset.previousValue || intervalSelectValue; // Store the previous value

    if (!intervalSelect.checkValidity()) {
      intervalSelect.reportValidity(); // Display the warning message
    
      // Revert the value after a short delay
      setTimeout(function() {
        intervalSelect.value = previousValue; // Restore the previous value
      }, 2500);
    } else {
      intervalSelect.dataset.previousValue = intervalSelect.value; // Update the previous value
      intervalSelectValue = intervalSelect.value;
    }
  }

  // Handle playlist input event
  function handlePlaylistInput() {
    var inputValue = loadPlaylistInput.value.trim(); // Trim whitespace

    if (inputValue.length > 0) {
      loadPlaylistButton.disabled = false; // Enable the button
    } else {
      loadPlaylistButton.disabled = true; // Disable the button
    }
  }

  // Handle load playlist button click event
  function handleLoadPlaylistButtonClick() {
    var inputValue = loadPlaylistInput.value.trim();
    var isUrl = /^https?:\/\/[\w\-]+(\.[\w\-]+)+[/#?]?.*$/.test(inputValue);

    if (isUrl) {
      playlistFrame.src = inputValue;
    } else {
      playlistFrame.src = 'https://www.youtube.com/embed/videoseries?list=' + inputValue;
    }

    loadPlaylistInput.value = '';

    playlistFrame.onerror = function() {
      loadPlaylistInput.value = inputValue;
      playlistFrame.style.backgroundImage = 'url("error-graphic.png")';
      // Or, you can set a custom text message
      // playlistFrame.textContent = 'Error loading playlist';
    };

    playlistFrame.onload = function() {
      playlistFrame.style.backgroundImage = 'none';
    };

    loadPlaylistButton.disabled = true;
  }
  
  // Start the progress indicator
  function startProgressIndicator() {
    progressWidth = 100;
    progressIteration = intervalSelectValue;
    progressIndicator.style.width = progressWidth + '%';
    progressIntervalId = setInterval(updateProgressIndicator, 1000);
    isProgressUpdating = true;
  }

  // Stop the progress indicator
  function stopProgressIndicator() {
    clearInterval(progressIntervalId);
    progressIntervalId = null;
    isProgressUpdating = false;
  }

  // Update the progress indicator
  function updateProgressIndicator() {
    var stepWidth = Math.ceil(100 / intervalSelectValue);

    progressIteration -= 1;
    progressWidth = Math.max(progressWidth - stepWidth, 0);  // Ensure progressWidth doesn't go below 0
    progressIndicator.style.width = progressWidth + '%';

    if (progressIteration < 0) {
      stopProgressIndicator();
      generateRandomWord();
    }
  }

  // Reset the progress indicator
  function resetProgressIndicator() {
    stopProgressIndicator();
    progressWidth = 0;
    progressIndicator.style.width = progressWidth + '%';
  }
});
</script>

</body>
</html>
