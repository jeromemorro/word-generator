window.addEventListener('DOMContentLoaded', function() {
  var wordDisplay = document.getElementById('word-display');
  var intervalSelect = document.getElementById('interval-select');
  var generatorToggle = document.getElementById('generator-toggle-button');
  var progressBar = document.getElementById('progress-indicator');
  var wordIntervalId;
  var isWordGenerationRunning = false;
  var currentWordDuration = parseInt(intervalSelect.value) * 1000; // Convert selected value to milliseconds
  var progressIntervalId;
  var progressIncrement;
  var progressWidth = 100;
  
  var words = []; // Array to store the word entries from the JSON file

  function generateRandomWord() {
    var filteredWords = words;

    // Generate a random word from the filtered list
    if (filteredWords.length > 0) {
      var randomNumber = Math.floor(Math.random() * filteredWords.length);
      var randomWord = filteredWords[randomNumber].w;

      wordDisplay.textContent = randomWord;
      startProgressIndicator();
    } else {
      wordDisplay.textContent = 'No matching words found.';
    }
  }

  fetch('words-temp.json')
    .then(function(response) {
      return response.json();
    })
    .then(function(data) {
      words = data;
      startWordGeneration();
      generatorToggle.textContent = 'Stop generator';
      generatorToggle.style.backgroundColor = 'limegreen';
    })
    .catch(function(error) {
      console.error('Error fetching words:', error);
    });

  function startWordGeneration() {
    var interval = parseInt(intervalSelect.value) * 1000; // Convert selected value to milliseconds
    wordIntervalId = setInterval(generateRandomWord, interval);
    isWordGenerationRunning = true;
  }

  function stopWordGeneration() {
    clearInterval(wordIntervalId);
    clearInterval(progressIntervalId);
    wordIntervalId = null;
    progressIntervalId = null;
    isWordGenerationRunning = false;
    progressWidth = 100;
    progressBar.style.width = '100%';
  }

  function toggleWordGeneration() {
    if (isWordGenerationRunning) {
      // Word generation is currently running, stop it
      stopWordGeneration();
      generatorToggle.textContent = 'Start generator';
      generatorToggle.style.backgroundColor = 'red';
    } else {
      // Word generation is currently stopped, start it
      startWordGeneration();
      generatorToggle.textContent = 'Stop generator';
      generatorToggle.style.backgroundColor = 'limegreen';
    }
  }

  function handleOptionChange() {
    if (isWordGenerationRunning) {
      // Word generation is currently running, update the interval duration
      var interval = parseInt(intervalSelect.value) * 1000; // Convert selected value to milliseconds
      clearInterval(wordIntervalId);
      clearInterval(progressIntervalId);
      wordIntervalId = setInterval(generateRandomWord, interval);
      currentWordDuration = interval;
      progressWidth = 100;
      progressBar.style.width = '100%';
      startProgressIndicator();
    }
  }

  function startProgressIndicator() {
    clearInterval(progressIntervalId);
    progressIncrement = 100 / (currentWordDuration / 1000); // Calculate the decrement per second
    progressIntervalId = setInterval(updateProgress, 1000);
  }

  function updateProgress() {
    if (progressWidth > 0) {
      progressWidth -= progressIncrement;
      progressBar.style.width = progressWidth + '%';
    } else {
      clearInterval(progressIntervalId);
      progressIntervalId = null;
      progressWidth = 100;
      progressBar.style.width = '100%';
    }
  }

  generatorToggle.addEventListener('click', toggleWordGeneration);
  intervalSelect.addEventListener('change', handleOptionChange);
});
